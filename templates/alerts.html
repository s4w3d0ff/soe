<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alerts</title>
<style>
:root {
	--text: #518c81;
	--bg: #060709;
	--bg-gray: #3333334d;
	--prime: #00241b;
	--second: #004447;
	--accent: #008DA8;
}

@font-face {
  font-family: Silkscreen;
  src: local(Silkscreen-Regular.ttf);
}

body {
	font-family: Silkscreen;
	margin: 0;
	padding: 0;
	background-color: transparent;
}
		
#alerts-container {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.alert {
    background-color: var(--bg-gray);
    color: var(--text);
    padding: 15px;
    border-radius: 5px;
    border-left: 4px solid var(--accent);
    width: fit-content;
    max-width: 80%;
    position: relative;
	opacity: 0;
    transition: all 0.7s ease, transform 0.7s ease;
}

.alert.show {
    opacity: 1;
}

.alert.removing {
    opacity: 0;
}

.alert span {
    margin-right: 10px;
}

.alert #sys_message {
    color: var(--accent);
}
</style>
</head>
<body>
<div id="alerts-container">
	<!-- Alerts will be added dynamically -->
</div>
<script>
function addAlert(alert) {
    // Create the alert div
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert';
    alertDiv.id = alert.notice_type;

    // Create the system message span
    const sysMessageSpan = document.createElement('span');
    sysMessageSpan.className = 'sys_message';
    sysMessageSpan.textContent = alert.sys_message;

    // Append span to the alert div
    alertDiv.appendChild(sysMessageSpan);

    // Get the alerts container
    const container = document.getElementById('alerts-container');

    // Add the alert to the container
    container.appendChild(alertDiv);

    // Force a reflow before adding the show class
    alertDiv.offsetHeight;

    // Add show class to trigger the animation
    requestAnimationFrame(() => {
        alertDiv.classList.add('show');
    });

    // Set up removal timer
    setTimeout(() => {
        // Add the removing class to trigger the slide out animation
        alertDiv.classList.add('removing');
        
        // Remove the element after the animation completes
        setTimeout(() => {
            alertDiv.remove();
        }, 700); // Match the transition duration
    }, 7000);
}
function connectWebSocket() {
	ws = new WebSocket('ws://localhost:5050/alertsws');

	ws.addEventListener('open', () => {
		console.log('WebSocket connection established');
	});

	ws.addEventListener('error', (error) => {
		console.error('WebSocket error:', error);
	});

	ws.addEventListener('close', () => {
		console.log('WebSocket connection closed');
		setTimeout(connectWebSocket, 1000);
	});

	ws.addEventListener('message', (event) => {
		try {
			const alert = JSON.parse(event.data);
			addAlert(alert);
		} catch (error) {
			console.error('Error processing message:', error);
		}
	});
}
connectWebSocket();
</script>
</body>
</html>